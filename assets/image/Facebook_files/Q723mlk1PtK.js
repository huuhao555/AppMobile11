;/*FB_PKG_DELIM*/

__d("MWMessageElementRefList",[],(function(a,b,c,d,e,f){"use strict";function a(){var a=new Map(),b=new Map(),c={contents:void 0};return{get:function(b,d){var e=a.get(b);if(e==null){c.contents=[b,d];return}return d(e)},set:function(d){var e=b.get(d);if(e!=null)return e;e=function(b){if(b==null){a["delete"](d);return}a.set(d,b);if(c.contents!=null&&c.contents[0]===d){var e=c.contents;e[0];e=e[1];e(b);c.contents=void 0;return}};b.set(d,e);return e}}}f["default"]=a}),66);
__d("useMWV2ConversationScrollerRefs",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useMemo,j=b.useRef;function a(){var a=j(null),b=j({type:"Bottom"});return i(function(){return{scrollerRef:a,scrollPositionRef:b}},[])}g["default"]=a}),98);
__d("useMWLSIsViewerThreadAdminUsingThreadKey",["MWPActor.react","ReQL","ReQLSuspense","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=d("MWPActor.react").useActor(),e=(h||(h=c("useReStore")))(),g=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(e.table("participants")).getKeyRange(a,b)},[e,b,a],f.id+":24");return(g=g==null?void 0:g.isAdmin)!=null?g:!1}g["default"]=a}),98);
__d("useMWCurrentVisibleMessage",["I64","Int64Hooks","LSFactory","LSMessagePointQueryStoredProcedure","MWMessageElementRefList","MWPVisibleMessageContext.react","ReQL","ReQLSuspense","WALoggerDeferred","promiseDone","react","setTimeout","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[occam] useMWCurrentVisibleMessage: incorrect call to MPQ with secure mailbox"]);k=function(){return a};return a}b=j||d("react");var l=b.useCallback,m=b.useEffect,n=b.useRef,o=b.useState;function a(a,b){var e=d("MWPVisibleMessageContext.react").useMWPVisibleMessageContext(),g=e.visibleMessage,j=n(c("MWMessageElementRefList")()),p=a==null?void 0:a.threadKey,q=a==null?void 0:a.threadType,r=n(),s=(h||(h=c("useReStore")))(),t=d("ReQLSuspense").useFirst(function(){if(p==null)return d("ReQL").empty();if(g==null)return d("ReQL").fromTableDescending(s.table("messages_ranges_v2__generated")).getKeyRange(p);var a=g.timestamp;return d("ReQL").fromTableDescending(s.table("messages_ranges_v2__generated")).getKeyRange(p).bounds({lte:[a]}).filter(function(b){var c=b.maxTimestampMs;b=b.minTimestampMs;return(i||(i=d("I64"))).ge(a,b)&&(i||(i=d("I64"))).le(a,c)})},[p,g,s],f.id+":58");e=o(function(){return t});var u=e[0],v=e[1];m(function(){r.current=void 0,g==null&&b.current!=null&&b.current.scrollToBottom()},[b,g]);var w=l(function(a){var d=b.current;if(d!=null){c("setTimeout")(function(){return d.scrollElementIntoViewIfNeeded(a)},0);return}},[b]),x=l(function(a){if(a!==r.current)return j.current.get(a,function(b){w(b),r.current=a})},[w]);m(function(){t!=null?v(t):g==null&&v(function(){})},[g,t,v]);m(function(){g!=null&&u!=null&&x(g.messageId)},[s,g,u,x]);d("Int64Hooks").useEffectInt64(function(){if(a!=null&&t==null&&g!=null){var b,e=g.messageId;b=(i||(i=d("I64"))).to_int32((b=q)!=null?b:(i||(i=d("I64"))).neg_one);b!==-1&&(b===15||b===16)&&c("promiseDone")(d("WALoggerDeferred").ERROR(k()));c("promiseDone")(s.runInTransaction(function(b){return c("LSMessagePointQueryStoredProcedure")(c("LSFactory")(b),{messageId:e,threadKey:a.threadKey,threadType:a.threadType})},"readwrite"))}},[s,g,t,p,q,a]);return{messageElementRefs:j,messageRange:u,visibleMessage:(e=g)!=null?e:void 0}}g["default"]=a}),98);
__d("MWThreadUtilHooks",["LSMessagingThreadTypeUtil","MWCMThreadTypes.react","MWLSThread","MWPActor.react","ReQL","ReQLSuspense","useMWCurrentVisibleMessage","useMWLSIsViewerThreadAdminUsingThreadKey","useMWV2ConversationScrollerRefs","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=c("useMWV2ConversationScrollerRefs")();b=c("useMWCurrentVisibleMessage")(a,b.scrollerRef);b=b.messageRange;b=(b=b==null?void 0:b.isLoadingBefore)!=null?b:!1;var e=a.threadKey,g=(h||(h=c("useReStore")))();a=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableDescending(g.table("messages")).getKeyRange(e).filter(function(a){return!a.isAdminMessage})},[g,e],f.id+":37");var i=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableDescending(g.table("attachments")).getKeyRange(e)},[g,e],f.id+":46");a=a!=null||i!=null;return!(a||b)}function j(a){var b=i(a);return!b?!1:d("LSMessagingThreadTypeUtil").isDiscoverablePublicBroadcastChannel(a.threadType)}function a(a){var b=i(a);a=d("MWLSThread").useThread(a.threadKey,function(a){return a.threadSubtype});return!b?!1:d("MWCMThreadTypes.react").isIGBroadcastChannelThread(a)}function b(a){var b=j(a);a=c("useMWLSIsViewerThreadAdminUsingThreadKey")(a.threadKey);return d("MWPActor.react").isAPPlus&&b&&a}g.useMWIsThreadWithZeroMessage=i;g.useMWIsFBBroadcastChannelWithZeroMessage=j;g.useMWIsIGBroadcastChannelWithZeroMessage=a;g.useMWIsAdminAndFBBroadcastChannelWithZeroMessage=b}),98);